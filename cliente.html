<!DOCTYPE html>
<html>
<head>
  <title>Cliente</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<h1>Cliente</h1>

<input id="mesa" type="number" placeholder="Número de mesa">
<button onclick="cargarMenu()">Ver menú</button>

<div id="menu"></div>
<div id="carrito"></div>

<script type="module">
import { db } from "./firebase.js";
import { getDocs, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

let carrito = [];

window.cargarMenu = async function() {
  const snap = await getDocs(collection(db, "productos"));
  const div = document.getElementById("menu");
  div.innerHTML = "<h2>Menú</h2>";

  snap.forEach(doc => {
    const p = doc.data();
    div.innerHTML += `
      <div>
        ${p.nombre} - $${p.precio}
        <button onclick="agregar('${p.nombre}', ${p.precio})">Agregar</button>
      </div>
    `;
  });
};

window.agregar = function(nombre, precio) {
  carrito.push({ nombre, precio });
  renderCarrito();
};

function renderCarrito() {
  document.getElementById("carrito").innerHTML = `
    <h2>Carrito</h2>
    ${carrito.map(p => `<div>${p.nombre} - $${p.precio}</div>`).join("")}
    <button onclick="enviar()">Enviar pedido</button>
  `;
}

window.enviar = async function() {
  const mesa = document.getElementById("mesa").value;
  if (!mesa) return alert("Ingresá mesa");

  await addDoc(collection(db, "pedidos"), {
    mesa,
    items: carrito,
    estado: "pendiente",
    createdAt: serverTimestamp()
  });

  carrito = [];
  alert("Pedido enviado");
};
</script>

</body>
</html>